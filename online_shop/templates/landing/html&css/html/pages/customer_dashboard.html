{% extends 'landing/html&css/html/pages/layout/_base.html' %}
{% load humanize %}
{% load product_extras %}
{% block title %}Dashboard{% endblock %}
{% block content %}
    <h1 class="mx-auto mt-5 text-behance text-center">Dashboard</h1>
    <!-- Modal-success -->
    {% if messages %}
        <div class="modal fade" id="success_modal" tabindex="-1" role="dialog"
             aria-labelledby="exampleModalLabel_success"
             aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title text-success" id="exampleModalLabel_success"><b>Order Submitted</b></h5>
                        <button id="success_modal_close" type="button" class="close" data-dismiss="modal"
                                aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body m-auto">
                        <ul class="messages">
                            {% for message in messages %}
                                <li{% if message.tags %}
                                    class="text-behance {{ message.tags }}"{% endif %}>{{ message }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {#                <div class="modal-footer">#}
                    {#                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>#}
                    {#                    <button id="modal_delete" value="" type="button" class="btn btn-danger" data-dismiss="modal">Delete#}
                    {#                    </button>#}
                    {#                </div>#}
                </div>
            </div>
        </div>
    {% endif %}
    <div class="container-fluid p-5">
        <ul class="nav nav-pills text-danger">
            <li class="active"><a class="btn btn-behance mr-2 active rounded-0" data-toggle="pill"
                                  href="#orders_tab">Orders</a>
            </li>
            <li><a class="btn btn-behance mx-2 rounded-0" data-toggle="pill" href="#addresses_tab">Addresses</a></li>
            <li><a class="btn btn-behance mx-2 rounded-0" data-toggle="pill" href="#personal_tab">Personal</a></li>
            <li><a class="btn btn-behance mx-2 rounded-0" data-toggle="pill" href="#favorite_products_tab">Favorite
                Products</a></li>
        </ul>

        <div class="tab-content card bg-primary shadow-inset border-light p-4 rounded-0">
            <div id="orders_tab" class="tab-pane active m-md-5 m-2">
                <ul class="nav nav-pills text-danger">
                    <li class="active"><a class="btn btn-outline-danger shadow-none mr-2 active rounded-0"
                                          data-toggle="pill"
                                          href="#unfinished_order_items">Unfinished Items</a></li>
                    <li class=""><a class="btn btn-outline-danger shadow-none mx-2 rounded-0" data-toggle="pill"
                                    href="#unpaid_orders">Unpaid
                        Orders</a>
                    </li>
                    <li class=""><a class="btn btn-outline-danger shadow-none mx-2 rounded-0" data-toggle="pill"
                                    href="#sending_orders">Sending
                        Orders</a>
                    </li>
                    <li class=""><a class="btn btn-outline-danger shadow-none mx-2 rounded-0" data-toggle="pill"
                                    href="#finished_orders">Finished
                        Orders
                    </a></li>
                </ul>

                <div class="tab-content card bg-primary shadow-inset border-light p-4 rounded-0">
                    <div id="unfinished_order_items" class="tab-pane active">
                        {% for order_item in order_items %}
                            <div id="container_{{ order_item.id }}"
                                 class="card bg-primary shadow-inset border-light p-4 my-2 col-11 mx-auto">
                                <div class="card-header shadow-soft text-center border border-light rounded col-12 mx-5 d-flex justify-content-between flex-wrap align-self-center">
                                    <a target="_blank"
                                       href="{% url 'products:product_detail' pk=order_item.product.id %}"><img
                                            src="{{ order_item.product.image.url }}" alt="{{ order_item.product.name }}"
                                            height="100"></a>
                                    <p class="my-auto">{{ order_item.product.brand }} </p>
                                    <p class="my-auto">{{ order_item.product.name }} </p>
                                    {% if order_item.product.discount or order_item.product.category.discount or order_item.product.brand.discount %}
                                        <div class="my-auto">
                                            <p class="my-auto">
                                                <del>{{ order_item.product.price | toman_format | intcomma }}</del>
                                            </p>
                                            <p class="my-auto">{{ order_item.product.final_price | toman_format | intcomma }}</p>
                                        </div>
                                    {% else %}
                                        <p class="my-auto">{{ order_item.product.final_price | toman_format | intcomma }}</p>
                                    {% endif %}
                                    <div class="my-auto">
                                        <p class="my-auto"><b>Total:</b></p>
                                        <p class="my-auto"
                                           id="order_item_price_{{ order_item.id }}"> {{ order_item.final_price | toman_format | intcomma }} </p>
                                    </div>
                                    <div class="my-auto d-flex justify-content-between">
                                        {% if order_item.product == order_item.product %}
                                            {% if order_item.count == 1 %}
                                                <button id="minus"
                                                        onclick="minus_order({{ order_item.product.id }}, {{ order_item.id }})"
                                                        type="button"
                                                        class="btn btn-primary mt-2 col-4 col-md-4 text-danger text-center"
                                                        tabindex="0"><span
                                                        id="count-icon-{{ order_item.id }}" class="fas fa-trash"></span>
                                                </button>
                                            {% else %}
                                                <button id="minus"
                                                        onclick="minus_order({{ order_item.product.id }}, {{ order_item.id }})"
                                                        type="button"
                                                        class="btn btn-primary mt-2 col-4 col-md-4 text-danger text-center"
                                                        tabindex="0"><span
                                                        id="count-icon-{{ order_item.id }}"
                                                        class="fas fa-minus-square"></span>
                                                </button>
                                            {% endif %}
                                            <span id="{{ order_item.id }}"
                                                  class="mx-2 mx-sm-4 my-auto">{{ order_item.count }}</span>
                                        {% endif %}
                                        <button id="add"
                                                onclick="add_order({{ order_item.product.id }}, {{ order_item.id }})"
                                                type="button"
                                                class="btn btn-primary mt-2 col-4 col-md-4 text-success text-center"
                                                tabindex="0"><span
                                                class="fas fa-plus-square"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                        {% if order_items %}
                            <div id="continue_ordering" class="text-center">
                                <a href="{% url 'orders:order_create' %}">
                                    <button class="btn btn-success col-8 col-sm-5 col-md-3 col-lg-2">Continue Ordering
                                    </button>
                                </a>
                            </div>
                        {% endif %}
                        {% if not order_items %}
                            <h4 class="my-5 text-center text-dribbble mx-auto">There is no unfinished order items!</h4>
                        {% endif %}
                    </div>
                    <div id="unpaid_orders" class="tab-pane fade">
                        {% if not unpaid_orders %}
                            <h4 class="my-5 text-center text-dribbble mx-auto">There is no unpaid orders!</h4>
                        {% endif %}
                        {% for unpaid_order in unpaid_orders %}
                            <div class="card bg-primary shadow-inset border-light p-4 my-2 col-11 mx-auto">
                                <div class="card-header shadow-soft text-center border border-light rounded col-12 mx-5 d-flex justify-content-between flex-wrap align-self-center">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="container-fluid mb-5">
                                                <div class="row">
                                                    {% for order_item in unpaid_order.orderitem_set.all %}
                                                        <div class="container-fluid col-2 my-0">
                                                            <div class="row">
                                                                <img class="rounded mx-auto mt-4"
                                                                     src="{{ order_item.product.image.url }}"
                                                                     alt="{{ order_item.product }}" width="150"
                                                                     height="150">
                                                            </div>
                                                            <div class="row">
                                                                <span class='badge badge-dribbble m-auto'> <b>{{ order_item.count }}</b> </span>
                                                            </div>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            <div class="container-fluid">
                                                <div class="row mx-auto align-items-center justify-content-center">
                                                    <h3 class="col-12 mx-auto mb-5 border-bottom border-success text-success">
                                                        {{ unpaid_order.created }}</h3>
                                                    <h4 class="mx-auto mt-3 border-bottom border-behance text-behance">
                                                        Address</h4>
                                                    <div id="address_{{ unpaid_order.address.id }}"
                                                         class="card bg-primary shadow-inset border-light p-4 my-2 col-12 mx-auto">
                                                        <div class="card-header shadow-soft text-center border border-light rounded">
                                                            <div class="container-fluid">
                                                                <div class="row m-0 p-0">
                                                                    <div class="text-left my-auto col-10">
                                                                        <div class="my-auto row">
                                                                            <p class="mx-3 my-3">
                                                                                <b>Province:</b> {{ unpaid_order.address.get_province_display | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>City:</b> {{ unpaid_order.address.city | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Area:</b> {{ unpaid_order.address.area | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Avenue:</b> {{ unpaid_order.address.avenue | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Street:</b> {{ unpaid_order.address.street | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Alley:</b> {{ unpaid_order.address.alley | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>No:</b> {{ unpaid_order.address.no | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Unit:</b> {{ unpaid_order.address.unit | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Floor:</b> {{ unpaid_order.address.floor | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3"><b>ZIP
                                                                                Code:</b> {{ unpaid_order.address.postal_code | non_destroyer }}
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% for order_item in unpaid_order.orderitem_set.all|slice:":1" %}
                                                        <table class="table table-hover table-success">
                                                            <thead>
                                                            <tr>
                                                                <th>Final Price</th>
                                                                <th>Final Discount</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <tr>
                                                                <td>{{ unpaid_order.final_price | toman_format | intcomma }}</td>
                                                                <td>{{ unpaid_order.final_discount_calculator }}</td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    {% endfor %}
                                                    {% if unpaid_order.off_code %}
                                                        <h4 class="mx-auto mt-3 border-bottom border-behance text-behance">
                                                            Off Code</h4>
                                                        <div class="col-12 text-center m-auto">{{ unpaid_order.off_code }}</div>
                                                    {% endif %}
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div id="sending_orders" class="tab-pane fade">
                        {% if not sending_orders %}
                            <h4 class="my-5 text-center text-dribbble mx-auto">There is no sending orders!</h4>
                        {% endif %}
                        {% for sending_order in sending_orders %}
                            <div class="card bg-primary shadow-inset border-light p-4 my-2 col-11 mx-auto">
                                <div class="card-header shadow-soft text-center border border-light rounded col-12 mx-5 d-flex justify-content-between flex-wrap align-self-center">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="container-fluid mb-5">
                                                <div class="row">
                                                    {% for order_item in sending_order.orderitem_set.all %}
                                                        <div class="container-fluid col-2 my-0">
                                                            <div class="row">
                                                                <img class="rounded mx-auto mt-4"
                                                                     src="{{ order_item.product.image.url }}"
                                                                     alt="{{ order_item.product }}" width="150"
                                                                     height="150">
                                                            </div>
                                                            <div class="row">
                                                                <span class='badge badge-dribbble m-auto'> <b>{{ order_item.count }}</b> </span>
                                                            </div>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            <div class="container-fluid">
                                                <div class="row mx-auto align-items-center justify-content-center">
                                                    {% for error in form.errors.values %}
                                                        <div id="form_alert"
                                                             class="alert alert-danger border border-danger shadow-soft col-6 m-auto justify-content-center align-items-center text-danger rounded">
                                                            <b class="border-bottom border-danger">
                                                                {% if 'required.' in error|striptags %}
                                                                    Address: {% else %}Off Code:
                                                                {% endif %}</b>{{ error|striptags }}
                                                        </div>
                                                    {% endfor %}
                                                    {% csrf_token %}
                                                    <h3 class="col-12 mx-auto mb-5 border-bottom border-success text-success">
                                                        {{ sending_order.created }}</h3>
                                                    <h4 class="mx-auto mt-3 border-bottom border-behance text-behance">
                                                        Address</h4>
                                                    <div id="address_{{ sending_order.address.id }}"
                                                         class=" card bg-primary shadow-inset border-light p-4 my-2 col-12 mx-auto">
                                                        <div class="card-header shadow-soft text-center border border-light rounded">
                                                            <div class="container-fluid">
                                                                <div class="row m-0 p-0">
                                                                    <div class="text-left my-auto col-10">
                                                                        <div class="my-auto row">
                                                                            <p class="mx-3 my-3">
                                                                                <b>Province:</b> {{ sending_order.address.get_province_display | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>City:</b> {{ sending_order.address.city | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Area:</b> {{ sending_order.address.area | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Avenue:</b> {{ sending_order.address.avenue | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Street:</b> {{ sending_order.address.street | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Alley:</b> {{ sending_order.address.alley | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>No:</b> {{ sending_order.address.no | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Unit:</b> {{ sending_order.address.unit | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Floor:</b> {{ sending_order.address.floor | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3"><b>ZIP
                                                                                Code:</b> {{ sending_order.address.postal_code | non_destroyer }}
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% for order_item in sending_order.orderitem_set.all|slice:":1" %}
                                                        <table class="table table-hover table-success">
                                                            <thead>
                                                            <tr>
                                                                <th>Final Price</th>
                                                                <th>Final Discount</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <tr>
                                                                <td>{{ sending_order.final_price | toman_format | intcomma }}</td>
                                                                <td>{{ sending_order.final_discount_calculator }}</td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    {% endfor %}
                                                    {% if sending_order.off_code %}
                                                        <h4 class="mx-auto mt-3 border-bottom border-behance text-behance">
                                                            Off Code</h4>
                                                        <div class="col-12 text-center m-auto">{{ sending_order.off_code }}</div>
                                                    {% endif %}
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div id="finished_orders" class="tab-pane fade">
                        {% if not finished_orders %}
                            <h4 class="my-5 text-center text-dribbble mx-auto">There is no finished orders!</h4>
                        {% endif %}
                        {% for finished_order in finished_orders %}
                            <div class="card bg-primary shadow-inset border-light p-4 my-2 col-11 mx-auto">
                                <div class="card-header shadow-soft text-center border border-light rounded col-12 mx-5 d-flex justify-content-between flex-wrap align-self-center">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="container-fluid mb-5">
                                                <div class="row">
                                                    {% for order_item in finished_order.orderitem_set.all %}
                                                        <div class="container-fluid col-2 my-0">
                                                            <div class="row">
                                                                <img class="rounded mx-auto mt-4"
                                                                     src="{{ order_item.product.image.url }}"
                                                                     alt="{{ order_item.product }}" width="150"
                                                                     height="150">
                                                            </div>
                                                            <div class="row">
                                                                <span class='badge badge-dribbble m-auto'> <b>{{ order_item.count }}</b> </span>
                                                            </div>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            <div class="container-fluid">
                                                <div class="row mx-auto align-items-center justify-content-center">
                                                    {% for error in form.errors.values %}
                                                        <div id="form_alert"
                                                             class="alert alert-danger border border-danger shadow-soft col-6 m-auto justify-content-center align-items-center text-danger rounded">
                                                            <b class="border-bottom border-danger">
                                                                {% if 'required.' in error|striptags %}
                                                                    Address: {% else %}Off Code:
                                                                {% endif %}</b>{{ error|striptags }}
                                                        </div>
                                                    {% endfor %}
                                                    {% csrf_token %}
                                                    <h3 class="col-12 mx-auto mb-5 border-bottom border-success text-success">
                                                        {{ finished_order.created }}</h3>
                                                    <h4 class="mx-auto mt-3 border-bottom border-behance text-behance">
                                                        Address</h4>
                                                    <div id="address_{{ finished_order.address.id }}"
                                                         class=" card bg-primary shadow-inset border-light p-4 my-2 col-12 mx-auto">
                                                        <div class="card-header shadow-soft text-center border border-light rounded">
                                                            <div class="container-fluid">
                                                                <div class="row m-0 p-0">
                                                                    <div class="text-left my-auto col-10">
                                                                        <div class="my-auto row">
                                                                            <p class="mx-3 my-3">
                                                                                <b>Province:</b> {{ finished_order.address.get_province_display | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>City:</b> {{ finished_order.address.city | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Area:</b> {{ finished_order.address.area | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Avenue:</b> {{ finished_order.address.avenue | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Street:</b> {{ finished_order.address.street | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Alley:</b> {{ finished_order.address.alley | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>No:</b> {{ finished_order.address.no | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Unit:</b> {{ finished_order.address.unit | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3">
                                                                                <b>Floor:</b> {{ finished_order.address.floor | non_destroyer }}
                                                                            </p>
                                                                            <p class="mx-3 my-3"><b>ZIP
                                                                                Code:</b> {{ finished_order.address.postal_code | non_destroyer }}
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% for order_item in finished_order.orderitem_set.all|slice:":1" %}
                                                        <table class="table table-hover table-success">
                                                            <thead>
                                                            <tr>
                                                                <th>Final Price</th>
                                                                <th>Final Discount</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <tr>
                                                                <td>{{ finished_order.final_price | toman_format | intcomma }}</td>
                                                                <td>{{ finished_order.final_discount_calculator }}</td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    {% endfor %}
                                                    {% if finished_order.off_code %}
                                                        <h4 class="mx-auto mt-3 border-bottom border-behance text-behance">
                                                            Off Code</h4>
                                                        <div class="col-12 text-center m-auto">{{ finished_order.off_code }}</div>
                                                    {% endif %}
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div id="addresses_tab" class="tab-pane fade">
                {% for address in addresses %}
                    <div id="address_{{ address.id }}"
                         class="customer_addresses card bg-primary shadow-inset border-light p-4 my-2 col-12 mx-auto">
                        <div class="card-header shadow-soft text-center border border-light rounded">
                            <div class="container-fluid">
                                <div class="row m-0 p-0">
                                    <div class="text-left my-auto col-10">
                                        <div class="my-auto row">
                                            <p class="mx-3 my-3">
                                                <b>Province:</b> <span id="province_{{ address.id }}">{{ address.get_province_display | non_destroyer }}</span>
                                            </p>
                                            <p class="mx-3 my-3">
                                                <b>City:</b> <span id="city_{{ address.id }}">{{ address.city | non_destroyer }}</span></p>
                                            <p class="mx-3 my-3">
                                                <b>Area:</b> <span id="area_{{ address.id }}">{{ address.area | non_destroyer }}</span></p>
                                            <p class="mx-3 my-3">
                                                <b>Avenue:</b> <span id="avenue_{{ address.id }}">{{ address.avenue | non_destroyer }}</span></p>
                                            <p class="mx-3 my-3">
                                                <b>Street:</b> <span id="street_{{ address.id }}">{{ address.street | non_destroyer }}</span></p>
                                            <p class="mx-3 my-3">
                                                <b>Alley:</b> <span id="alley_{{ address.id }}">{{ address.alley | non_destroyer }}</span></p>
                                            <p class="mx-3 my-3">
                                                <b>No:</b> <span id="no_{{ address.id }}">{{ address.no | non_destroyer }}</span>
                                            </p>
                                            <p class="mx-3 my-3">
                                                <b>Unit:</b> <span id="unit_{{ address.id }}">{{ address.unit | non_destroyer }}</span></p>
                                            <p class="mx-3 my-3">
                                                <b>Floor:</b> <span id="floor_{{ address.id }}">{{ address.floor | non_destroyer }}</span></p>
                                            <p class="mx-3 my-3"><b>ZIP
                                                Code:</b> <span id="postal_code_{{ address.id }}">{{ address.postal_code | non_destroyer }}</span></p>
                                        </div>
                                    </div>
                                    <div class="row my-auto col-4 col-md-1 mx-auto">
                                        <div class="m-1 justify-content-between">
                                            <div id="{{ address.id }}" onclick="address_editor('{{ address.city}}', '{{ address.area}}', '{{ address.avenue}}', '{{ address.street}}', '{{ address.alley}}', '{{ address.no}}', '{{ address.unit}}', '{{ address.floor}}', '{{ address.postal_code}}', '{{ address.id }}')"
                                                 class="address_edit my-1 btn btn-warning fas fa-edit col-12"
                                                 data-toggle="modal" data-target="#exampleModal3"></div>
                                            <div id="{{ address.id }}"
                                                 class="address_delete my-1 btn btn-danger fas fa-trash-alt col-12"
                                                 data-toggle="modal" data-target="#exampleModal"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                {% if not addresses %}
                    <div id="no_address_handler"
                         class="card bg-primary shadow-inset border-light p-4 my-3 col-11 mx-auto">
                        <h1>
                            <pre> </pre>
                        </h1>
                        <h3 class="text-center text-danger"><b>You don't have any addresses!!</b></h3>
                        <h1>
                            <pre> </pre>
                        </h1>
                    </div>
                {% endif %}
                <div class="container-fluid m-auto">
                    <div class="row m-auto">
                        <div id="address_creator_button"
                             class="btn btn-success fas fa-plus-square col-6 col-md-2 mx-auto"
                             data-toggle="modal" data-target="#exampleModal2"> New Address
                        </div>
                    </div>
                </div>
            </div>
            <div id="personal_tab" class="tab-pane fade">
                <header class="card-header shadow-soft text-center border border-light rounded m-md-4">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="container-fluid col-md-3 col-12 my-auto">
                                <div class="row">
                                    <img id="customer_image" class="rounded my-auto" src="{{ customer.image.url }}"
                                         alt="{{ user.last_name }}" width="300">
                                    <div id="update_customer_button"
                                         class="my-auto mx-auto btn btn-warning fas fa-edit col-8 col-md-4 col-lg-2"
                                         data-toggle="modal" data-target="#customer_update_form_modal"></div>
                                </div>
                            </div>
                            <div class="container-fluid col-md-9 col-12 rounded border p-5 b border-behance shadow-inset shadow-lg align-self-center"
                                 style="border-width:4px !important;">
                                <div class="row justify-content-center ">
                                    <div id="update_user_button"
                                         class=" my-1 btn btn-warning fas fa-edit col-6 col-md-1"
                                         data-toggle="modal" data-target="#user_update_form_modal"></div>
                                    <div class="container-fluid">
                                        <div class="row text-md-left border border-success p-2">
                                            <h4 class="fas fa-user m-auto mr-md-auto ml-md-5 my-auto"><b
                                                    class="text-gray"> First Name:</b></h4>
                                            <p class="ml-auto mr-5 my-auto h5"
                                               id="first_name">{{ user.first_name | non_destroyer }}</p>
                                        </div>
                                    </div>
                                    <div class="container-fluid">
                                        <div class="row text-md-left border border-success p-2">
                                            <h4 class="fas fa-user m-auto mr-md-auto ml-md-5 my-auto"><b
                                                    class="text-gray"> Last Name:</b></h4>
                                            <p class="ml-auto mr-5 my-auto h5"
                                               id="last_name">{{ user.last_name | non_destroyer }}</p>
                                        </div>
                                    </div>
                                    <div class="container-fluid">
                                        <div class="row text-md-left border border-success p-2">
                                            <h4 class="fas fa-phone m-auto mr-md-auto ml-md-5 my-auto"><b
                                                    class="text-gray"> Phone:</b></h4>
                                            <p class="ml-auto mr-5 my-auto h5"
                                               id="phone">{{ user.phone }}</p>
                                        </div>
                                    </div>
                                    <div class="container-fluid">
                                        <div class="row text-md-left border  border-success p-2">
                                            <h4 class="fas fa-envelope m-auto mr-md-auto ml-md-5 my-auto"><b
                                                    class="text-gray"> Email:</b></h4>
                                            <p class="ml-auto mr-5 my-auto h5"
                                               id="email">{{ user.email | non_destroyer }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
            </div>
            <div id="favorite_products_tab" class="tab-pane fade">
                {#                <h3>Menu 3</h3>#}
                {#                <p>Eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt#}
                {#                    explicabo.</p>#}
            </div>
        </div>
    </div>


    <!-- Modal-user -->
    <div class="modal fade" id="user_update_form_modal" tabindex="-1" role="dialog"
         aria-labelledby="user_update_form_modal_label"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-behance" id="user_update_form_modal_label"><b>Update Profile</b></h5>
                    <button id="update_user_modal_close" type="button" class="close" data-dismiss="modal"
                            aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div id="user_update_form_container" class="modal-body m-auto">
                    {% load crispy_forms_tags %}
                    <form id="user_update_form">
                        {% crispy user_update_form %}
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                    <button id="user_update_modal" onclick="update_profile({{ user.id }})" type="button"
                            class="btn btn-success">Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal-customer -->
    <div class="modal fade" id="customer_update_form_modal" tabindex="-1" role="dialog"
         aria-labelledby="customer_update_form_modal_label"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-behance" id="customer_update_form_modal_label"><b>Change Photo</b></h5>
                    <button id="update_customer_modal_close" type="button" class="close" data-dismiss="modal"
                            aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div id="customer_update_form_container" class="modal-body m-auto">
                    {% load crispy_forms_tags %}
                    <form id="customer_update_form" enctype="multipart/form-data">
                        {% crispy customer_update_form %}
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                    <button id="customer_update_modal" onclick="update_photo({{ customer.id }})" type="button"
                            class="btn btn-success">Save
                    </button>
                </div>
            </div>
        </div>
    </div>
    {#edit address#}
    <div class="modal fade" id="exampleModal3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel3"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-warning" id="exampleModalLabel3"><b>Edit Address</b></h5>
                    <button id="address_edit_modal_close" type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body m-auto" id="address_edit_form_container">
                    {% load crispy_forms_tags %}
                    <form id="address_edit_form">
                        {% crispy address_form %}
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                    <button id="modal_edit" type="button" class="btn btn-success" value="" onclick="update_address(this.value)">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal-address -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                {#      <div class="modal-header">#}
                {#        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>#}
                {#        <button type="button" class="close" data-dismiss="modal" aria-label="Close">#}
                {#          <span aria-hidden="true">&times;</span>#}
                {#        </button>#}
                {#      </div>#}
                <div class="modal-body m-auto">
                    <p class="text-danger"><b>Are you sure you want to delete this address?</b></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                    <button id="modal_delete" value="" type="button" class="btn btn-danger" data-dismiss="modal">Delete
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-behance" id="exampleModalLabel2"><b>Create Address</b></h5>
                    <button id="modal_close" type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body m-auto" id="address_create_form_container">
                    {% load crispy_forms_tags %}
                    <form id="address_create_form">
                        {% crispy address_form %}
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                    <button id="modal_create" type="button" class="btn btn-success">Save</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
    <script>
        function update_profile(user_id) {
            $.ajax({
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                url: "{% url 'customers:user_update_api_view' pk=12345 %}".replace(/12345/, user_id),
                method: "PATCH",
                data: {
                    first_name: $('#id_first_name').val(),
                    last_name: $('#id_last_name').val(),
                    phone: $('#id_phone').val(),
                    email: $('#id_email').val(),
                    username: $('#id_phone').val(),
                },
                success: function (success) {
                    $('#required_error').remove()
                    $('#first_name').text(non_destroyer(success.first_name))
                    $('#last_name').text(non_destroyer(success.last_name))
                    $('#phone').text(non_destroyer(success.phone))
                    $('#email').text(non_destroyer(success.email))
                    $('#update_user_modal_close').trigger('click')
                },
                error: function (error) {
                    $('#required_error').remove()
                    for (let field of Object.keys(error.responseJSON)) {
                        if (field !== 'username') {
                            let html = `<p id="required_error" class="text-danger m-auto"><b class="border-bottom border-danger">${field}: </b>${error.responseJSON[field][0]}</p>`
                            $('#user_update_form_container').append(html)
                        }

                    }
                }
            })
        }

        function update_photo(customer_id) {
            var formData = new FormData(document.getElementById("customer_update_form"))
            $.ajax({
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                url: "{% url 'customers:customer_update_api_view' pk=12345 %}".replace(/12345/, customer_id),
                method: "PATCH",
                data: formData,
                cache: false,
                contentType: false,
                processData: false,
                success: function (success) {
                    $('#image_error').remove()
                    $('#update_customer_modal_close').trigger('click')
                    $('#customer_image').attr('src', success.image)
                },
                error: function (error) {
                    $('#image_error').remove()
                    for (let field of Object.keys(error.responseJSON)) {
                        let html = `<p id="image_error" class="text-danger m-auto"><b class="border-bottom border-danger">${field}: </b>${error.responseJSON[field][0]}</p>`
                        $('#customer_update_form_container').append(html)
                    }
                }
            })
        }

        function minus_order(product_id, id) {
            $(`#${id}`).html(Number($(`#${id}`).text()) - 1)
            if (Number($(`#${id}`).text()) >= 1) {
                $.ajax({
                    url: "{% url 'orders:order_item_of_product' %}",
                    method: "GET",
                    data: {
                        product_id: product_id,
                    },
                    success: function (success) {
                        let order_item_id = success['id']
                        $.ajax({
                            headers: {
                                'X-CSRFTOKEN': '{{ csrf_token }}'
                            },
                            url: "{% url 'orders:orderitem-detail' pk=12345 %}".replace(/12345/, order_item_id),
                            method: "PATCH",
                            data: {
                                {#csrfmiddlewaretoken: '{{ csrf_token }}',#}
                                count: Number($(`#${id}`).text())
                            },
                            success: function (success) {
                                $(`#order_item_price_${id}`).html(success.formatted_price)
                                $('#order_items_final_price').html(success.final_prices_sum)
                            },
                        })
                    },
                    error: function () {
                        $.ajax({
                            url: '{% url 'orders:not_login_handler' %}',
                            method: 'PATCH',
                            headers: {
                                'X-CSRFTOKEN': '{{ csrf_token }}'
                            },
                            data: {
                                product_id: product_id,
                                count: Number($(`#${id}`).text())
                            },
                            success: function (success) {
                                $(`#order_item_price_${id}`).html(success.formatted_price)
                                $('#order_items_final_price').html(success.final_prices_sum)
                            },
                        })
                    }

                })
            }


            if (Number($(`#${id}`).text()) === 1) {
                $(`#count-icon-${id}`).removeClass('fa-minus-square')
                $(`#count-icon-${id}`).addClass('fa-trash')
            }

            if (Number($(`#${id}`).text()) === 0) {
                $.ajax({
                    url: "{% url 'orders:order_item_of_product' %}",
                    method: "GET",
                    data: {
                        product_id: product_id,
                    },
                    success: function (success) {
                        let order_item_id = success['id']
                        $.ajax({
                            headers: {
                                'X-CSRFTOKEN': '{{ csrf_token }}'
                            },
                            url: "{% url 'orders:orderitem-detail' pk=12345 %}".replace(/12345/, order_item_id),
                            method: "DELETE",
                            data: {
                                count: Number($(`#${id}`).text())
                            },
                            success: function () {
                                let html = '<h4 class="my-5 text-center text-dribbble mx-auto">There is no unfinished order items!</h4>'
                                $('#unfinished_order_items').append(html)
                            }
                        })
                    },
                    error: function () {
                        $.ajax({
                            url: '{% url 'orders:not_login_handler' %}',
                            method: 'DELETE',
                            headers: {
                                'X-CSRFTOKEN': '{{ csrf_token }}'
                            },
                            data: {
                                product_id: product_id,
                                count: Number($(`#${id}`).text())
                            },
                        })
                    }
                })
                {#$(`#${id}`).remove()#}
                {#$('#minus').remove()#}
                {#$('#add').remove()#}
                {#html = '<button id="order" onclick="order({{ object.id }})" type="button" class="btn btn-primary btn-block mt-5" tabindex="0"><span class="fas fa-cart-plus mr-2"></span>Add to Cart </button>'#}
                {#$('#order-div').append(html)#}
                $('#cart_count').html(Number($('#cart_count').text()) - 1)
                $(`#container_${id}`).remove()
                if ($('#order_items_container').children().length === 0) {
                    let html = '<div class="card bg-primary shadow-inset border-light p-4 my-3 col-11 mx-auto"> <h1><pre> </pre></h1> <h1><pre> </pre></h1> <h3 class="text-center text-danger"><b>You Dont have any order items!</b></h3> <h1><pre> </pre></h1> <h1><pre> </pre></h1> </div>'
                    $('#order_items_container').append(html)
                    $('#prices-sum').remove()
                    $('#continue_ordering').remove()
                }
            }
        }

        function add_order(product_id, id) {
            $(`#${id}`).html(Number($(`#${id}`).text()) + 1)
            $.ajax({
                url: "{% url 'orders:order_item_of_product' %}",
                method: "GET",
                data: {
                    product_id: product_id,
                },
                success: function (success) {
                    let order_item_id = success['id']
                    $.ajax({
                        headers: {
                            'X-CSRFTOKEN': '{{ csrf_token }}'
                        },
                        url: "{% url 'orders:orderitem-detail' pk=12345 %}".replace(/12345/, order_item_id),
                        method: "PATCH",
                        data: {
                            count: Number($(`#${id}`).text())
                        },
                        success: function (success) {
                            $(`#order_item_price_${id}`).html(success.formatted_price)
                            $('#order_items_final_price').html(success.final_prices_sum)
                        },
                    })
                },
                error: function () {
                    $.ajax({
                        url: '{% url 'orders:not_login_handler' %}',
                        method: 'PATCH',
                        headers: {
                            'X-CSRFTOKEN': '{{ csrf_token }}'
                        },
                        data: {
                            product_id: product_id,
                            count: Number($(`#${id}`).text())
                        },
                        success: function (success) {
                            $(`#order_item_price_${id}`).html(success.formatted_price)
                            $('#order_items_final_price').html(success.final_prices_sum)
                        },
                    })
                }
            })

            if (Number($(`#${id}`).text()) > 1) {
                $(`#count-icon-${id}`).removeClass('fa-trash')
                $(`#count-icon-${id}`).addClass('fa-minus-square')
            }
        }

        $('.address_delete').click(function () {
            let address_id = $(this).attr('id')
            $('#modal_delete').val(address_id)
        })

        function address_editor(city, area, avenue, street, alley, no, unit, floor, postal_code, id) {
            $('#modal_edit').attr('value', Number(id))
            $('#id_city').attr('value', city)
            $('#id_area').attr('value', area)
            $('#id_avenue').attr('value', avenue)
            $('#id_street').attr('value', street)
            $('#id_alley').attr('value', alley)
            $('#id_no').attr('value', Number(no))
            $('#id_unit').attr('value', Number(unit))
            $('#id_floor').attr('value', Number(floor))
            $('#id_postal_code').attr('value', Number(postal_code))
        }

        function update_address(address_id){
            $.ajax({
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                url: "{% url 'customers:address_update_api_view' pk=12345 %}".replace(/12345/, address_id),
                method: "PATCH",
                data: {
                    province: $('#id_province').val(),
                    city: $('#id_city').val(),
                    area: $('#id_area').val(),
                    avenue: $('#id_avenue').val(),
                    street: $('#id_street').val(),
                    alley: $('#id_alley').val(),
                    no: $('#id_no').val(),
                    unit: $('#id_unit').val(),
                    floor: $('#id_floor').val(),
                    postal_code: $('#id_postal_code').val(),
                },
                success: function (success) {
                    $('#address_edit_error').remove()
                    $(`#city_${success.id}`).text(non_destroyer(success.city))
                    $(`#area_${success.id}`).text(non_destroyer(success.area))
                    $(`#avenue_${success.id}`).text(non_destroyer(success.avenue))
                    $(`#street_${success.id}`).text(non_destroyer(success.street))
                    $(`#alley_${success.id}`).text(non_destroyer(success.alley))
                    $(`#no_${success.id}`).text(non_destroyer(success.no))
                    $(`#unit_${success.id}`).text(non_destroyer(success.unit))
                    $(`#floor_${success.id}`).text(non_destroyer(success.floor))
                    $(`#postal_code_${success.id}`).text(non_destroyer(success.postal_code))
                    $('#address_edit_modal_close').trigger('click')
                },
                error: function (error) {
                    $('#address_edit_error').remove()
                    for (let field of Object.keys(error.responseJSON)) {
                        let html = `<p id="address_edit_error" class="text-danger m-auto"><b class="border-bottom border-danger">${field}: </b>${error.responseJSON[field][0]}</p>`
                        $('#address_edit_form_container').append(html)

                    }
                }
            })
        }

        $('#modal_delete').click(function () {
            let address_id = $(this).val()
            $.ajax({
                headers: {
                    'X-CSRFTOKEN': '{{ csrf_token }}'
                },
                url: "{% url 'customers:address_delete_api_view' pk=12345 %}".replace(/12345/, address_id),
                method: "DELETE",
                success: function () {
                    $(`#address_${address_id}`).remove()
                    if (!$('.customer_addresses').length) {
                        let html = '<div id="no_address_handler"class="card bg-primary shadow-inset border-light p-4 my-3 col-11 mx-auto"> <h1> <pre> </pre> </h1> <h3 class="text-center text-danger"><b>You dont have any addresses!!</b></h3> <h1> <pre> </pre></h1> </div>'
                        $('#addresses_tab').prepend(html)
                    }
                }
            })
        })

        $('#modal_create').click(function () {
            $('#address_edit_form').remove()
            $.ajax({
                url: "{% url 'customers:address_create_api_view' %}",
                method: "POST",
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    province: $('#id_province').val(),
                    city: $('#id_city').val(),
                    area: $('#id_area').val(),
                    avenue: $('#id_avenue').val(),
                    street: $('#id_street').val(),
                    alley: $('#id_alley').val(),
                    no: $('#id_no').val(),
                    unit: $('#id_unit').val(),
                    floor: $('#id_floor').val(),
                    postal_code: $('#id_postal_code').val(),
                },
                success: function (success) {
                    $('#address_error').remove()
                    let address_box_html = `<div id="address_${success.id}"` +
                        'class="card bg-primary shadow-inset border-light p-4 my-2 col-12 mx-auto">' +
                        '<div class="card-header shadow-soft text-center border border-light rounded">' +
                        `<div class="container-fluid"><div class="row m-0 p-0">` +
                        '<div class="my-auto row">' +
                        `<p class="mx-3 my-3"><b>Province:</b> ${non_destroyer(success.complete_province)}</p>` +
                        `<p class="mx-3 my-3"><b>City:</b> ${non_destroyer(success.city)}</p>` +
                        `<p class="mx-3 my-3"><b>Area:</b> ${non_destroyer(success.area)}</p>` +
                        `<p class="mx-3 my-3"><b>Avenue:</b> ${non_destroyer(success.avenue)}</p>` +
                        `<p class="mx-3 my-3"><b>Street:</b> ${non_destroyer(success.street)}</p>` +
                        `<p class="mx-3 my-3"><b>Alley:</b> ${non_destroyer(success.alley)}</p>` +
                        `<p class="mx-3 my-3"><b>No:</b> ${non_destroyer(success.no)}</p>` +
                        `<p class="mx-3 my-3"><b>Unit:</b> ${non_destroyer(success.unit)}</p>` +
                        `<p class="mx-3 my-3"><b>Floor:</b> ${non_destroyer(success.floor)}</p>` +
                        `<p class="mx-3 my-3"><b>ZIP Code:</b> ${non_destroyer(success.postal_code)}</p>` +
                        '</div>' +
                        '<div class="row my-auto col-4 col-md-1 mx-auto">' +
                        '<div class="m-1 justify-content-between">' +
                        `<div id="${success.id}" onclick="address_editor(${success.city}, ${success.area}, ${success.avenue}, ${success.street}, ${success.alley}, ${success.no}, ${success.unit}, ${success.floor}, ${success.postal_code}, ${success.id}" class="address_edit my-1 btn btn-warning fas fa-edit col-12" data-toggle="modal" data-target="#exampleModal3"></div>` +
                        `<div id="${success.id}" class="address_delete my-1 btn btn-danger fas fa-trash-alt col-12" data-toggle="modal" data-target="#exampleModal"></div>` +
                        '</div></div></div></div></div></div>'
                    if ($('.customer_addresses').length) {
                        $('#addresses_tab').prepend(address_box_html)
                    } else {
                        $('#addresses_tab').prepend(address_box_html)
                        $('#no_address_handler').remove()
                    }
                    {#$('#modal_create').attr('data-dismiss', "modal")#}
                    $('#modal_close').trigger('click')
                    $('#address_create_form').trigger('reset')
                    {#let update_form = #}
                    {#$('#address_update_form_container').append(update_form)#}
                },
                error: function (error) {
                    $('#address_error').remove()
                    for (let field of Object.keys(error.responseJSON)) {
                        let html = `<p id="address_error" class="text-danger m-auto"><b class="border-bottom border-danger">${field}: </b>${error.responseJSON[field][0]}</p>`
                        $('#address_create_form_container').append(html)

                    }
                    {#let update_form = #}
                    {#$('#address_update_form_container').append(update_form)#}
                }
            })
        })

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        $(window).on('load', function () {
            $('#success_modal').modal('show')
            sleep(1800).then(() => {
                $('#success_modal_close').trigger('click')
            });
        });
    </script>
{% endblock %}